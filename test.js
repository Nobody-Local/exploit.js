if (location.host != "chrome.google.com" || !location.pathname.startsWith("/webstorex")) {
    alert("https://chrome.google.com/webstorexへ移動し終わった後もう一度、このブックマークレートをクリックしてください。");
    location.href = "https://chrome.google.com/webstorex";
}
document.head.innerHTML = `
<style>
body {
    margin: 8px;
}
.extensions {
    width: 100%;
}
.extensions * {
    transition: all .7s;
}
.extensions > * {
    display: block;
}
.extensions .yes {
    width: 5%;
    padding: 5px;
    color: rgb(0, 255, 55);
    cursor: pointer;
    border: 1px solid #000;
    border-radius: 5px;
}
.extensions .no {
    width: 5%;
    padding: 5px;
    color: rgb(128, 128, 128);
    cursor: pointer;
    border: 1px solid #000;
    border-radius: 5px;
}
.extensions .name {
    width: 50%;
}
.extensions .by {
    width: 20%;
}
</style>
`
document.body = document.createElement("body");
/*
function toggleFunction(id) {
  var clickedRow = document.getElementById(id);
  chrome.management.setEnabled(id, clickedRow.children[0].children[0].children[0].classList.toggle("yes") && clickedRow.children[0].children[0].children[0].classList.toggle("no"));
};
 */
document.setup = (id) => {
    /* alert(`${id}`); */
    // ↑test用
    chrome.management.setEnabled(id, document.getElementById(id).classList.contains("no"));
    document.getElementById(id).querySelector(".switch").classList.toggle("yes");
    document.getElementById(id).querySelector(".switch").classList.toggle("no");
    document.getElementById(id).querySelector(".switch").innerHTML = (document.getElementById(id).classList.contains("no") ? 'Running' : 'Stoping');
}

document.newBodyData = '<div class="extensions">'

chrome.management.getAll(function() {
  arguments[0].forEach((extension) => {
    document.newBodyData += `<div id="${extension.id}" onclick=\"setup('${extension.id}')\"><div class="switch ${extension.enabled ? 'yes' : 'no'}">${extension.enabled ? 'Running' : 'Stoping'}</div><div class="name" title="${extension.id}">${extension.name}</div><div class="by">Installed By ${extension.installType}</div></div><br>`;
  });

  document.newBodyData += "</div>"
  document.body.innerHTML = document.newBodyData;
});
